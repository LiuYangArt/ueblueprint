<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Slim IR Experiment</title>
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #00d4ff;
        }
        .section {
            background: #16213e;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .section h2 {
            color: #4ecca3;
            margin-top: 0;
        }
        pre {
            background: #0f0f23;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .ir { color: #ffd700; }
        .t3d { color: #4ecca3; }
        .stats { color: #ff6b6b; }
        button {
            background: #4ecca3;
            color: #1a1a2e;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px 10px 0;
        }
        button:hover {
            background: #45b393;
        }
        .success { color: #4ecca3; }
        .error { color: #ff6b6b; }
        #result {
            font-weight: bold;
            font-size: 18px;
            padding: 10px;
        }
        .copy-btn {
            background: #6c5ce7;
            font-size: 12px;
            padding: 6px 12px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Slim IR â†’ T3D Experiment</h1>
    
    <div class="section">
        <h2>ç›®æ ‡</h2>
        <p>éªŒè¯èƒ½å¦ä»ç´§å‡‘çš„ JSON æ ¼å¼ï¼ˆSlim IRï¼‰ç”Ÿæˆæœ‰æ•ˆçš„ T3D æ–‡æœ¬ï¼Œå¹¶è¢«è§£æå™¨æ­£ç¡®è§£æã€‚</p>
        <button onclick="runExperiment()">â–¶ è¿è¡Œå®éªŒ</button>
        <button class="copy-btn" onclick="copyT3D()">ğŸ“‹ å¤åˆ¶ T3D</button>
        <div id="result"></div>
    </div>
    
    <div class="section">
        <h2>è¾“å…¥ï¼šSlim IR (<span id="irSize">-</span> bytes)</h2>
        <pre id="irOutput" class="ir"></pre>
    </div>
    
    <div class="section">
        <h2>è¾“å‡ºï¼šT3D (<span id="t3dSize">-</span> bytes)</h2>
        <pre id="t3dOutput" class="t3d"></pre>
    </div>
    
    <div class="section">
        <h2>ç»Ÿè®¡</h2>
        <pre id="stats" class="stats"></pre>
    </div>
    
    <div class="section">
        <h2>è§£æéªŒè¯</h2>
        <pre id="parseResult"></pre>
    </div>

    <script type="module">
        import { convertSlimIRToT3D, EXAMPLE_SLIM_IR } from './js/ai/SlimIRExperiment.js'
        import Grammar from './js/parser/Grammar.js'
        
        window.generatedT3D = ''
        
        window.runExperiment = function() {
            const ir = EXAMPLE_SLIM_IR
            const irJson = JSON.stringify(ir, null, 2)
            const irSize = JSON.stringify(ir).length
            
            document.getElementById('irOutput').textContent = irJson
            document.getElementById('irSize').textContent = irSize
            
            try {
                // Convert to T3D
                const t3d = convertSlimIRToT3D(ir)
                window.generatedT3D = t3d
                document.getElementById('t3dOutput').textContent = t3d
                document.getElementById('t3dSize').textContent = t3d.length
                
                // Stats
                const stats = [
                    `Slim IR: ${irSize} bytes`,
                    `T3D: ${t3d.length} bytes`,
                    `èŠ‚ç‚¹æ•°: ${ir.nodes.length}`,
                    `è¿æ¥æ•°: ${ir.connections.length}`,
                    ``,
                    `ğŸ’¡ Slim IR æ¯” T3D å° ${((1 - irSize/t3d.length) * 100).toFixed(1)}%`,
                    `ğŸ’¡ LLM åªéœ€ç”Ÿæˆ ${irSize} bytes è€Œä¸æ˜¯ ~${t3d.length} bytes`
                ]
                document.getElementById('stats').textContent = stats.join('\n')
                
                // Try to parse
                try {
                    const parsed = Grammar.parse(t3d)
                    if (parsed && parsed.length > 0) {
                        document.getElementById('parseResult').innerHTML = 
                            `<span class="success">âœ… è§£ææˆåŠŸï¼ç”Ÿæˆäº† ${parsed.length} ä¸ªèŠ‚ç‚¹</span>\n\n` +
                            parsed.map(n => `- ${n.entity?.getType?.() || n.constructor.name}`).join('\n')
                        document.getElementById('result').innerHTML = 
                            '<span class="success">âœ… å®éªŒæˆåŠŸï¼Slim IR â†’ T3D è½¬æ¢å¯è¡Œ</span>'
                    } else {
                        document.getElementById('parseResult').innerHTML = 
                            '<span class="error">âš ï¸ è§£æè¿”å›ç©ºç»“æœ</span>'
                        document.getElementById('result').innerHTML = 
                            '<span class="error">âš ï¸ è§£æè¿”å›ç©º</span>'
                    }
                } catch (parseErr) {
                    document.getElementById('parseResult').innerHTML = 
                        `<span class="error">âŒ è§£æå¤±è´¥: ${parseErr.message}</span>\n\n` +
                        `è¯·æ£€æŸ¥ T3D æ ¼å¼æ˜¯å¦æ­£ç¡®`
                    document.getElementById('result').innerHTML = 
                        '<span class="error">âŒ è§£æå¤±è´¥ï¼Œéœ€è¦è°ƒæ•´ T3D æ ¼å¼</span>'
                }
                
            } catch (err) {
                document.getElementById('result').innerHTML = 
                    `<span class="error">âŒ è½¬æ¢å¤±è´¥: ${err.message}</span>`
                console.error(err)
            }
        }
        
        window.copyT3D = function() {
            if (window.generatedT3D) {
                navigator.clipboard.writeText(window.generatedT3D)
                alert('T3D å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼\n\nä½ å¯ä»¥åœ¨ ai-demo.html ä¸­ç²˜è´´æµ‹è¯•')
            } else {
                alert('è¯·å…ˆè¿è¡Œå®éªŒ')
            }
        }
    </script>
</body>
</html>
